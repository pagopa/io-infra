# This is a template to run the SSL Let's Encrypt Certificate Renewal action on a schedule for the desired DNS zone

name: SSL Certificate Renewal Template  # Change the name with the following naming convention: *DNS Zone* SSL Certificate Renewal

# Uncomment the following block and set the desired execution timeframe in crontab syntax.

#on: 
  #schedule:
  #- cron: '30 6 * * 1,3,5' #Â Default to 6.30 AM on monday, wednesday and friday

jobs:

  executeSslCertificateRenewalWorkflow:

    name: Execute SSL Certificate Renewal workflow
    uses: pagopa/io-infra/.github/workflows/ssl_certificate_renewal.yaml@main
    secrets:
      arm-client-id: ${{ secrets.ARM_CLIENT_ID }}
      arm-tenant-id: ${{ secrets.ARM_TENANT_ID }}
      arm-subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
    permissions:
      id-token: write
    with:
      csr_common_name: '' # CSR common name - expecting a string - example: test.io-poc.pagopa.it
      azure_dns_zone_resource_group: '' # Azure Resource Group that contains the target DNS zone - expecting a string - example: 'dev-xxxx'
      azure_dns_zone: '' # DNS zone for which we are renewing the certificate - expecting a string - example: 'io-poc.pagopa.it'
      key_vault_name: '' # Name of the Key Vault used to store the certificate - expecting a string - example: 'io-d-itn-tlscert-kv-01'
      force_renew_cert: false # Force the certificate renewal - expecting a boolean 
      alternate_chain_cn: '' # Alternate CN for the certificate chain - expecting a string - example: 'ISRG Root X1'
      environment: '' # Environment used to run the Github workflow - expecting a string - example: 'dev-ci'
      use_selfhosted_agent: false # Specify to use a self hosted or a github hosted agent - expecting a boolean - default to true
