name: SSL Certificate Renewal Template  # Change the name with the following naming convention: *DNS Zone* SSL Certificate Renewal

on: # To run the template on a schedule, uncomment the schedule property and set the desired execution timeframe in crontab syntax. Remember to comment out or to delete the workflow_dispatch property.
  push:
  workflow_dispatch:
  #schedule:
  #- cron: '30 6 * * 1,3,5' # Default to 6.30 AM on monday, wednesday and friday

    inputs: # INPUTS BLOCK TO BE REMOVED
      csr_common_name:
        description: "CSR common name" # example: test.io-poc.pagopa.it
        type: string
        required: true
      azure_subscription_id: # example: 'aaaaaaaa-bbbb-cccc-dddd-fffffffffff'
        description: "Azure Subscription id for all the platform resources"
        type: string
        required: true
      azure_dns_zone_resource_group: # example: 'dev-xxxx'
        description: "Azure Resource Group that contains the target DNS zone"
        type: string
        required: true
      azure_dns_zone: # example: 'io-poc.pagopa.it'
        description: "DNS zone for which we are renewing the certificate"
        type: string
        required: true
      key_vault_name: # example: 'io-d-itn-tlscert-kv-01'
        description: "Name of the Key Vault used to store the certificate"
        type: string
        required: true
      force_renew_cert:
        description: "Force the certificate renewal"
        type: boolean
        required: true
        default: false
      alternate_chain_cn: # example: 'CN=DST Root CA X3'
        description: "Alternate CN for the certificate chain"
        type: string
        required: false
      use_selfhosted_agent:
        description: Use a self hosted agent to run the workflow.
        type: boolean
        required: false
        default: false

jobs:

  executeSslCertificateRenewalWorkflow:

    name: Execute SSL Certificate Renewal workflow
    uses: pagopa/io-infra/.github/workflows/ssl_certificate_renewal.yaml@IOPLT-1309-ssl-cert-renewal-template # To be set to main
    with:
      # csr_common_name: '' # CSR common name - expecting a string - example: test.io-poc.pagopa.it
      # azure_subscription_id: '' # Azure Subscription id for all the platform resources - expecting a string - example: 'aaaaaaaa-bbbb-cccc-dddd-fffffffffff'
      # azure_dns_zone_resource_group: '' # Azure Resource Group that contains the target DNS zone - expecting a string - example: 'dev-xxxx'
      # azure_dns_zone: '' # DNS zone for which we are renewing the certificate - expecting a string - example: 'io-poc.pagopa.it'
      # key_vault_name: '' # Name of the Key Vault used to store the certificate - expecting a string - example: 'io-d-itn-tlscert-kv-01'
      # force_renew_cert: false # Force the certificate renewal - expecting a boolean 
      # alternate_chain_cn: '' # Alternate CN for the certificate chain - expecting a string - example: 'CN=DST Root CA X3'
      # use_selfhosted_agent: false # Specify to use a self hosted or a github hosted agent - expecting a boolean - default to true


      # BLOCK TO BE REMOVED
      csr_common_name: '{{ inputs.csr_common_name }}' # CSR common name - expecting a string - example: test.io-poc.pagopa.it
      azure_subscription_id: '{{ inputs.azure_subscription_id }}' # Azure Subscription id for all the platform resources - expecting a string - example: 'aaaaaaaa-bbbb-cccc-dddd-fffffffffff'
      azure_dns_zone_resource_group: '{{ inputs.azure_dns_zone_resource_group }}' # Azure Resource Group that contains the target DNS zone - expecting a string - example: 'dev-xxxx'
      azure_dns_zone: '{{ inputs.azure_dns_zone }}' # DNS zone for which we are renewing the certificate - expecting a string - example: 'io-poc.pagopa.it'
      key_vault_name: '{{ inputs.key_vault_name }}' # Name of the Key Vault used to store the certificate - expecting a string - example: 'io-d-itn-tlscert-kv-01'
      force_renew_cert: '{{ inputs.force_renew_cert }}' # Force the certificate renewal - expecting a boolean 
      alternate_chain_cn: '{{ inputs.alternate_chain_cn }}' # Alternate CN for the certificate chain - expecting a string - example: 'CN=DST Root CA X3'
      use_selfhosted_agent: '{{ inputs.use_selfhosted_agent }}' # Specify to use a self hosted or a github hosted agent - expecting a boolean - default to true
